\hypertarget{_prefab_8hpp_source}{}\doxysection{Prefab.\+hpp}
\label{_prefab_8hpp_source}\index{C:/Users/lllll/Documents/GitHub/UniEngine/include/lib/Engine/Resources/Prefab.hpp@{C:/Users/lllll/Documents/GitHub/UniEngine/include/lib/Engine/Resources/Prefab.hpp}}
\mbox{\hyperlink{_prefab_8hpp}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{preprocessor}{\#pragma once}}
\DoxyCodeLine{2 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{_animator_8hpp}{Animator.hpp}}>}}
\DoxyCodeLine{3 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{_i_asset_8hpp}{IAsset.hpp}}>}}
\DoxyCodeLine{4 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{_i_private_component_8hpp}{IPrivateComponent.hpp}}>}}
\DoxyCodeLine{5 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{_i_system_8hpp}{ISystem.hpp}}>}}
\DoxyCodeLine{6 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{_material_8hpp}{Material.hpp}}>}}
\DoxyCodeLine{7 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{_mesh_8hpp}{Mesh.hpp}}>}}
\DoxyCodeLine{8 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{_skinned_mesh_8hpp}{SkinnedMesh.hpp}}>}}
\DoxyCodeLine{9 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{_transform_8hpp}{Transform.hpp}}>}}
\DoxyCodeLine{10 }
\DoxyCodeLine{11 \textcolor{keyword}{namespace }\mbox{\hyperlink{namespace_uni_engine}{UniEngine}}}
\DoxyCodeLine{12 \{}
\DoxyCodeLine{13 \textcolor{preprocessor}{\#ifdef USE\_ASSIMP}}
\DoxyCodeLine{14 \textcolor{keyword}{struct }UNIENGINE\_API AssimpNode}
\DoxyCodeLine{15 \{}
\DoxyCodeLine{16     aiNode *m\_correspondingNode = \textcolor{keyword}{nullptr};}
\DoxyCodeLine{17     std::string m\_name;}
\DoxyCodeLine{18     Transform m\_localTransform;}
\DoxyCodeLine{19     AssimpNode(aiNode *node);}
\DoxyCodeLine{20     std::shared\_ptr<AssimpNode> m\_parent;}
\DoxyCodeLine{21     std::vector<std::shared\_ptr<AssimpNode>> m\_children;}
\DoxyCodeLine{22     std::shared\_ptr<Bone> m\_bone;}
\DoxyCodeLine{23     \textcolor{keywordtype}{bool} m\_hasMesh;}
\DoxyCodeLine{24 }
\DoxyCodeLine{25     \textcolor{keywordtype}{bool} NecessaryWalker(std::map<std::string, std::shared\_ptr<Bone>> \&boneMap);}
\DoxyCodeLine{26     \textcolor{keywordtype}{void} AttachToAnimator(std::shared\_ptr<Animation> \&animation, \textcolor{keywordtype}{size\_t} \&index);}
\DoxyCodeLine{27     \textcolor{keywordtype}{void} AttachChild(std::shared\_ptr<Bone> \&parent, \textcolor{keywordtype}{size\_t} \&index);}
\DoxyCodeLine{28 \};}
\DoxyCodeLine{29 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{30 \textcolor{keyword}{struct }UNIENGINE\_API \mbox{\hyperlink{struct_uni_engine_1_1_data_component_holder}{DataComponentHolder}}}
\DoxyCodeLine{31 \{}
\DoxyCodeLine{32     \mbox{\hyperlink{struct_uni_engine_1_1_data_component_type}{DataComponentType}} \mbox{\hyperlink{struct_uni_engine_1_1_data_component_holder_afda444df00ad5948fee95da7c59641d2}{m\_type}};}
\DoxyCodeLine{33     std::shared\_ptr<IDataComponent> \mbox{\hyperlink{struct_uni_engine_1_1_data_component_holder_a3ba0311752c30ec8006dbff2880a7ec9}{m\_data}};}
\DoxyCodeLine{34 }
\DoxyCodeLine{35     \textcolor{keywordtype}{void} Serialize(YAML::Emitter \&out);}
\DoxyCodeLine{36     \textcolor{keywordtype}{bool} Deserialize(\textcolor{keyword}{const} YAML::Node \&in);}
\DoxyCodeLine{37 \};}
\DoxyCodeLine{38 }
\DoxyCodeLine{39 \textcolor{keyword}{struct }UNIENGINE\_API \mbox{\hyperlink{struct_uni_engine_1_1_private_component_holder}{PrivateComponentHolder}}}
\DoxyCodeLine{40 \{}
\DoxyCodeLine{41     \textcolor{keywordtype}{bool} \mbox{\hyperlink{struct_uni_engine_1_1_private_component_holder_a5739a436a2319d2963a6415104d15294}{m\_enabled}};}
\DoxyCodeLine{42     std::shared\_ptr<IPrivateComponent> \mbox{\hyperlink{struct_uni_engine_1_1_private_component_holder_a434073105b761e2b65967c0e775e3310}{m\_data}};}
\DoxyCodeLine{43 }
\DoxyCodeLine{44     \textcolor{keywordtype}{void} Serialize(YAML::Emitter \&out);}
\DoxyCodeLine{45     \textcolor{keywordtype}{void} Deserialize(\textcolor{keyword}{const} YAML::Node \&in);}
\DoxyCodeLine{46 \};}
\DoxyCodeLine{47 }
\DoxyCodeLine{48 \textcolor{keyword}{class }UNIENGINE\_API \mbox{\hyperlink{class_uni_engine_1_1_prefab}{Prefab}} : \textcolor{keyword}{public} \mbox{\hyperlink{class_uni_engine_1_1_i_asset}{IAsset}}}
\DoxyCodeLine{49 \{}
\DoxyCodeLine{50     \textcolor{keywordtype}{bool} m\_enabled = \textcolor{keyword}{true};}
\DoxyCodeLine{51     \textcolor{keyword}{friend} \textcolor{keyword}{class }\mbox{\hyperlink{class_uni_engine_1_1_default_resources}{DefaultResources}};}
\DoxyCodeLine{52 \textcolor{preprocessor}{\#pragma region Model Loading}}
\DoxyCodeLine{53     \textcolor{keywordtype}{void} AttachAnimator(\mbox{\hyperlink{class_uni_engine_1_1_prefab}{Prefab}} *parent, \textcolor{keyword}{const} \mbox{\hyperlink{struct_uni_engine_1_1_handle}{Handle}} \&animatorEntityHandle);}
\DoxyCodeLine{54 }
\DoxyCodeLine{55     std::shared\_ptr<Texture2D> CollectTexture(}
\DoxyCodeLine{56         \textcolor{keyword}{const} std::string \&directory,}
\DoxyCodeLine{57         \textcolor{keyword}{const} std::string \&path,}
\DoxyCodeLine{58         std::map<std::string, std::shared\_ptr<Texture2D>> \&loadedTextures);}
\DoxyCodeLine{59 \textcolor{preprocessor}{\#ifdef USE\_ASSIMP}}
\DoxyCodeLine{60     \textcolor{keywordtype}{void} ApplyBoneIndices(\mbox{\hyperlink{class_uni_engine_1_1_prefab}{Prefab}} *node);}
\DoxyCodeLine{61     \textcolor{keywordtype}{void} ReadAnimations(}
\DoxyCodeLine{62         \textcolor{keyword}{const} aiScene *importerScene,}
\DoxyCodeLine{63         std::shared\_ptr<Animation> \&animator,}
\DoxyCodeLine{64         std::map<std::string, std::shared\_ptr<Bone>> \&bonesMap);}
\DoxyCodeLine{65     \textcolor{keywordtype}{void} ReadKeyFrame(\mbox{\hyperlink{struct_uni_engine_1_1_bone_key_frames}{BoneKeyFrames}} \&boneAnimation, \textcolor{keyword}{const} aiNodeAnim *channel);}
\DoxyCodeLine{66     std::shared\_ptr<Material> ReadMaterial(}
\DoxyCodeLine{67         \textcolor{keyword}{const} std::string \&directory,}
\DoxyCodeLine{68         \textcolor{keyword}{const} std::shared\_ptr<OpenGLUtils::GLProgram> \&glProgram,}
\DoxyCodeLine{69         std::map<std::string, std::shared\_ptr<Texture2D>> \&texture2DsLoaded,}
\DoxyCodeLine{70         aiMaterial *importerMaterial);}
\DoxyCodeLine{71     \textcolor{keywordtype}{bool} ProcessNode(}
\DoxyCodeLine{72         \textcolor{keyword}{const} std::string \&directory,}
\DoxyCodeLine{73         \mbox{\hyperlink{class_uni_engine_1_1_prefab}{Prefab}} *modelNode,}
\DoxyCodeLine{74         std::map<\textcolor{keywordtype}{unsigned}, std::shared\_ptr<Material>> \&loadedMaterials,}
\DoxyCodeLine{75         std::map<std::string, std::shared\_ptr<Texture2D>> \&texture2DsLoaded,}
\DoxyCodeLine{76         std::map<std::string, std::shared\_ptr<Bone>> \&bonesMap,}
\DoxyCodeLine{77         aiNode *importerNode,}
\DoxyCodeLine{78         std::shared\_ptr<AssimpNode> assimpNode,}
\DoxyCodeLine{79         \textcolor{keyword}{const} aiScene *importerScene,}
\DoxyCodeLine{80         \textcolor{keyword}{const} std::shared\_ptr<Animation> \&animation);}
\DoxyCodeLine{81     std::shared\_ptr<Mesh> ReadMesh(aiMesh *importerMesh);}
\DoxyCodeLine{82     std::shared\_ptr<SkinnedMesh> ReadSkinnedMesh(}
\DoxyCodeLine{83         std::map<std::string, std::shared\_ptr<Bone>> \&bonesMap, aiMesh *importerMesh);}
\DoxyCodeLine{84 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{85     \textcolor{keyword}{static} \textcolor{keywordtype}{void} ProcessNode(}
\DoxyCodeLine{86         \textcolor{keyword}{const} std::string \&directory,}
\DoxyCodeLine{87         std::map<\textcolor{keywordtype}{int}, std::vector<Vertex>> \&meshMaterials,}
\DoxyCodeLine{88         \textcolor{keyword}{const} tinyobj::shape\_t \&shape,}
\DoxyCodeLine{89         \textcolor{keyword}{const} tinyobj::attrib\_t \&attribute);}
\DoxyCodeLine{90 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{91     \textcolor{keywordtype}{void} AttachChildren(}
\DoxyCodeLine{92         \textcolor{keyword}{const} std::shared\_ptr<Prefab> \&modelNode,}
\DoxyCodeLine{93         \mbox{\hyperlink{struct_uni_engine_1_1_entity}{Entity}} parentEntity,}
\DoxyCodeLine{94         \textcolor{keyword}{const} std::string \&parentName,}
\DoxyCodeLine{95         std::unordered\_map<Handle, Handle> \&map) \textcolor{keyword}{const};}
\DoxyCodeLine{96 }
\DoxyCodeLine{97     \textcolor{keywordtype}{void} AttachChildrenPrivateComponent(}
\DoxyCodeLine{98         \textcolor{keyword}{const} std::shared\_ptr<Prefab> \&modelNode,}
\DoxyCodeLine{99         \textcolor{keyword}{const} \mbox{\hyperlink{struct_uni_engine_1_1_entity}{Entity}} \&parentEntity,}
\DoxyCodeLine{100         \textcolor{keyword}{const} std::unordered\_map<Handle, Handle> \&map) \textcolor{keyword}{const};}
\DoxyCodeLine{101     \textcolor{keywordtype}{void} RelinkChildren(\textcolor{keyword}{const} \mbox{\hyperlink{struct_uni_engine_1_1_entity}{Entity}} \&parentEntity, \textcolor{keyword}{const} std::unordered\_map<Handle, Handle> \&map) \textcolor{keyword}{const};}
\DoxyCodeLine{102 \textcolor{preprocessor}{\#pragma endregion}}
\DoxyCodeLine{103 }
\DoxyCodeLine{104   \textcolor{keyword}{protected}:}
\DoxyCodeLine{105     \textcolor{keywordtype}{bool} LoadInternal(\textcolor{keyword}{const} std::filesystem::path \&path) \textcolor{keyword}{override};}
\DoxyCodeLine{106     \textcolor{keywordtype}{bool} SaveInternal(\textcolor{keyword}{const} std::filesystem::path \&path) \textcolor{keyword}{override};}
\DoxyCodeLine{107     \textcolor{keywordtype}{void} LoadModelInternal(\textcolor{keyword}{const} std::filesystem::path \&path, \textcolor{keywordtype}{bool} optimize = \textcolor{keyword}{false}, \textcolor{keywordtype}{unsigned} flags = aiProcess\_Triangulate | aiProcess\_CalcTangentSpace | aiProcess\_GenSmoothNormals);}
\DoxyCodeLine{108     \textcolor{keywordtype}{void} SaveModelInternal(\textcolor{keyword}{const} std::filesystem::path \&path);}
\DoxyCodeLine{109   \textcolor{keyword}{public}:}
\DoxyCodeLine{110     \mbox{\hyperlink{struct_uni_engine_1_1_handle}{Handle}} m\_entityHandle = \mbox{\hyperlink{struct_uni_engine_1_1_handle}{Handle}}();}
\DoxyCodeLine{111     std::vector<DataComponentHolder> \mbox{\hyperlink{class_uni_engine_1_1_prefab_a15b11da85663af5569f13356683b9941}{m\_dataComponents}};}
\DoxyCodeLine{112     std::vector<PrivateComponentHolder> \mbox{\hyperlink{class_uni_engine_1_1_prefab_a220c689c7189200def21959a856d1d6f}{m\_privateComponents}};}
\DoxyCodeLine{113     std::vector<std::shared\_ptr<Prefab>> \mbox{\hyperlink{class_uni_engine_1_1_prefab_a48928f9704ffdcb17c917795d4c5dfb9}{m\_children}};}
\DoxyCodeLine{114     \textcolor{keyword}{template} <\textcolor{keyword}{typename} T = IPrivateComponent> std::shared\_ptr<T> GetPrivateComponent();}
\DoxyCodeLine{115     \textcolor{keywordtype}{void} OnCreate() \textcolor{keyword}{override};}
\DoxyCodeLine{116 }
\DoxyCodeLine{117     [[nodiscard]] \mbox{\hyperlink{struct_uni_engine_1_1_entity}{Entity}} ToEntity() \textcolor{keyword}{const};}
\DoxyCodeLine{118 }
\DoxyCodeLine{119     \textcolor{keywordtype}{void} LoadModel(\textcolor{keyword}{const} std::filesystem::path \&path, \textcolor{keywordtype}{bool} optimize = \textcolor{keyword}{false}, \textcolor{keywordtype}{unsigned} flags = aiProcess\_Triangulate | aiProcess\_CalcTangentSpace | aiProcess\_GenSmoothNormals);}
\DoxyCodeLine{120 }
\DoxyCodeLine{121     \textcolor{keywordtype}{void} \mbox{\hyperlink{class_uni_engine_1_1_prefab_ac223f8db5ff8b68f45b71bf400bfb034}{FromEntity}}(\textcolor{keyword}{const} \mbox{\hyperlink{struct_uni_engine_1_1_entity}{Entity}} \&entity);}
\DoxyCodeLine{122     \textcolor{keywordtype}{void} CollectAssets(std::unordered\_map<\mbox{\hyperlink{struct_uni_engine_1_1_handle}{Handle}}, std::shared\_ptr<IAsset>> \&map);}
\DoxyCodeLine{123     \textcolor{keywordtype}{void} Serialize(YAML::Emitter \&out);}
\DoxyCodeLine{124     \textcolor{keywordtype}{void} Deserialize(\textcolor{keyword}{const} YAML::Node \&in);}
\DoxyCodeLine{125 \};}
\DoxyCodeLine{126 }
\DoxyCodeLine{127 \textcolor{keyword}{template} <\textcolor{keyword}{typename} T> std::shared\_ptr<T> \mbox{\hyperlink{class_uni_engine_1_1_prefab_a7c98bc9e1816732a32c6e6af53992cda}{Prefab::GetPrivateComponent}}()}
\DoxyCodeLine{128 \{}
\DoxyCodeLine{129     \textcolor{keyword}{auto} typeName = SerializationManager::GetSerializableTypeName<T>();}
\DoxyCodeLine{130     \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} \&i : \mbox{\hyperlink{class_uni_engine_1_1_prefab_a220c689c7189200def21959a856d1d6f}{m\_privateComponents}})}
\DoxyCodeLine{131     \{}
\DoxyCodeLine{132         \textcolor{keywordflow}{if} (i.m\_data-\/>GetTypeName() == typeName)}
\DoxyCodeLine{133         \{}
\DoxyCodeLine{134             \textcolor{keywordflow}{return} std::static\_pointer\_cast<T>(i.m\_data);}
\DoxyCodeLine{135         \}}
\DoxyCodeLine{136     \}}
\DoxyCodeLine{137     \textcolor{keywordflow}{return} \textcolor{keyword}{nullptr};}
\DoxyCodeLine{138 \}}
\DoxyCodeLine{139 }
\DoxyCodeLine{140 \} \textcolor{comment}{// namespace UniEngine}}

\end{DoxyCode}
